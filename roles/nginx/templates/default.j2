server {
    listen 8080 default_server;
    location = /stub_status {
        stub_status;
    }
    
	  listen 80 default_server;
	  server_name _;

  	#location / {
  	#	uwsgi_pass localhost:5000;
  	#	include uwsgi_params;
  	#}

  	location /node-metrics {
  		proxy_pass http://localhost:9100/metrics;
  	}

    location /nginx-metrics {
    	proxy_pass http://localhost:9113/metrics;
    }

    location /influxdb-metrics {
  		proxy_pass http://localhost:9424/metrics;
  	}

    {% if inventory_hostname in groups['prometheus'] %}
    location /prometheus {
    		proxy_pass http://localhost:9090;
    }
    {% endif %}

    #{% if inventory_hostname in groups['grafana'] %}
    #location /grafana {
    #		proxy_pass http://localhost:3000;
    #}
    #{% endif %}

    {% if inventory_hostname in groups['db_servers'] %}
    location /mysql-metrics {
    		proxy_pass http://localhost:9104/metrics;
    }
    {% endif %}

    {% if inventory_hostname in groups['dns_servers'] %}
    location /bind-metrics {
    		proxy_pass http://localhost:9119/metrics;
    }
    {% endif %}

    {% if inventory_hostname in groups['influxdb'] %}
    location /influxdb {
    	  proxy_pass http://localhost:8086/metrics;
    }
    {% endif %}

    {% if inventory_hostname in groups['grafana'] %}
	  location /grafana {
		    proxy_pass http://localhost:{{ grafana_port }};
	  }
	  {% endif %}

    {% if inventory_hostname in groups['web_servers'] %}
		location / {
			proxy_pass http://localhost:{{ agama_port }};
			proxy_set_header Host $http_host;
		}
	  {% endif %}	

    {% if inventory_hostname in groups['loadbalancer'] %}
		
		location /keepalived-metrics {
				
			proxy_pass http://localhost:{{ keepalived_exporter_port }}/metrics;
		}
	  {% endif %}


	  {% if inventory_hostname in groups['loadbalancer'] %}
		
		location /haproxy-metrics {
				
			proxy_pass http://localhost:{{ haproxy_exporter_port }}/metrics;
		}
	  {% endif %}
}








